<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Universal CSV Report Generator</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
    font-family:Arial, sans-serif;
    background:linear-gradient(135deg,#667eea,#764ba2);
    min-height:100vh;
    padding:20px;
}
.container{max-width:1200px;margin:auto}

.card{
    background:#fff;
    border-radius:20px;
    padding:30px;
    margin:20px 0;
    box-shadow:0 10px 30px rgba(0,0,0,.2);
    text-align:center;
}

.hidden{display:none}

.upload-box{
    border:3px dashed #cbd5e0;
    padding:50px;
    cursor:pointer;
}
.upload-box:hover{background:#f7fafc}

.btn{
    background:#4c51bf;
    color:#fff;
    padding:14px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-size:1rem;
    width:100%;
    margin-top:10px;
}

.stats-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:20px;
}

.stat-card{
    background:#edf2ff;
    padding:20px;
    border-radius:10px;
}
.stat-title{font-size:14px;color:#333}
.stat-value{font-size:1.6rem;font-weight:bold;margin-top:5px}

table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #000;padding:8px;text-align:center}
th{background:#eee}
</style>
</head>

<body>
<div class="container">

<!-- HEADER -->
<div class="card">
    <h1>ðŸ“Š Universal CSV Report Generator</h1>
    <p>Analyze â€¢ Preview â€¢ Download any CSV</p>
</div>

<!-- UPLOAD -->
<div class="card" id="uploadSection">
    <div class="upload-box" onclick="fileInput.click()">
        <h2>Upload Any CSV File</h2><br>
        <button class="btn">Choose CSV File</button>
    </div>
    <input type="file" id="fileInput" accept=".csv" hidden>
</div>

<!-- ANALYSIS -->
<div class="card hidden" id="analysisSection">
    <h2>Data Summary</h2><br>

    <div class="stats-grid" id="summaryCards"></div>

    <button class="btn" onclick="generateReport()">Generate Report</button>
    <button class="btn hidden" id="downloadBtn">â¬‡ Download Report</button>
</div>

<!-- DATA TABLE -->
<div class="card hidden" id="dataSection">
    <h2>Data Preview</h2>
    <table>
        <thead id="tableHead"></thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

</div>

<script>
let csvData = {}, analysis = {}, fileName = "";
const fileInput = document.getElementById("fileInput");

fileInput.addEventListener("change", e => {
    const file = e.target.files[0];
    if(!file) return;
    fileName = file.name;
    const reader = new FileReader();
    reader.onload = () => parseCSV(reader.result);
    reader.readAsText(file);
});

function parseCSV(text){
    const lines = text.trim().split("\n");
    const headers = lines[0].split(",").map(h => h.trim());

    const rows = lines.slice(1).map(line=>{
        const values = line.split(",");
        let obj = {};
        headers.forEach((h,i)=>obj[h] = values[i]?.trim() || "");
        return obj;
    });

    csvData = { headers, rows };
    analyzeData();
    renderTable();
}

/* GENERIC ANALYSIS */
function analyzeData(){
    const numericColumns = csvData.headers.filter(h =>
        csvData.rows.some(r => !isNaN(parseFloat(r[h])))
    );

    let numericStats = {};

    numericColumns.forEach(col=>{
        const nums = csvData.rows
            .map(r=>parseFloat(r[col]))
            .filter(n=>!isNaN(n));

        numericStats[col] = {
            min: Math.min(...nums),
            max: Math.max(...nums),
            avg: (nums.reduce((a,b)=>a+b,0)/nums.length).toFixed(2)
        };
    });

    analysis = {
        records: csvData.rows.length,
        columns: csvData.headers.length,
        numericCount: numericColumns.length,
        numericStats
    };

    document.getElementById("uploadSection").classList.add("hidden");
    document.getElementById("analysisSection").classList.remove("hidden");
    document.getElementById("dataSection").classList.remove("hidden");

    renderSummary();
}

function renderSummary(){
    const box = document.getElementById("summaryCards");
    box.innerHTML = `
        <div class="stat-card">
            <div class="stat-title">Total Records</div>
            <div class="stat-value">${analysis.records}</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Total Columns</div>
            <div class="stat-value">${analysis.columns}</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Numeric Columns</div>
            <div class="stat-value">${analysis.numericCount}</div>
        </div>
    `;
}

function renderTable(){
    tableHead.innerHTML =
        "<tr><th>#</th>" +
        csvData.headers.map(h=>`<th>${h}</th>`).join("") +
        "</tr>";

    tableBody.innerHTML = csvData.rows.map((r,i)=>`
        <tr>
            <td>${i+1}</td>
            ${csvData.headers.map(h=>`<td>${r[h]}</td>`).join("")}
        </tr>
    `).join("");
}

/* REPORT HTML */
function getReportHTML(){
return `
<!DOCTYPE html>
<html>
<head>
<title>CSV Analysis Report</title>
<style>
body{font-family:Arial;padding:30px}
.header{display:flex;align-items:center;border-bottom:3px solid #4c51bf;padding-bottom:15px}
.logo{width:60px;height:60px;margin-right:15px}
h1{margin:0;color:#4c51bf}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{border:1px solid #000;padding:8px;text-align:center}
th{background:#edf2ff}
.footer{text-align:center;margin-top:30px;font-size:12px;color:#555}
</style>
</head>
<body>

<div class="header">
<svg class="logo" viewBox="0 0 100 100">
<circle cx="50" cy="50" r="48" fill="#4c51bf"/>
<text x="50" y="58" text-anchor="middle" font-size="40" fill="white">ðŸ“Š</text>
</svg>
<h1>Universal CSV Report</h1>
</div>

<p><b>File:</b> ${fileName}</p>
<p><b>Date:</b> ${new Date().toLocaleDateString()}</p>
<p><b>Total Records:</b> ${analysis.records}</p>
<p><b>Total Columns:</b> ${analysis.columns}</p>

<h3>Numeric Column Analysis</h3>
<table>
<tr><th>Column</th><th>Min</th><th>Max</th><th>Average</th></tr>
${Object.entries(analysis.numericStats).map(([k,v])=>`
<tr><td>${k}</td><td>${v.min}</td><td>${v.max}</td><td>${v.avg}</td></tr>
`).join("")}
</table>

<h3>Full Data</h3>
<table>
<tr><th>#</th>${csvData.headers.map(h=>`<th>${h}</th>`).join("")}</tr>
${csvData.rows.map((r,i)=>`
<tr><td>${i+1}</td>${csvData.headers.map(h=>`<td>${r[h]}</td>`).join("")}</tr>
`).join("")}
</table>

<div class="footer">
Generated by Universal CSV Report Generator
</div>

</body>
</html>`;
}

/* PREVIEW */
function generateReport(){
    const win = window.open("", "_blank");
    win.document.write(getReportHTML());
    win.document.close();
    document.getElementById("downloadBtn").classList.remove("hidden");
}

/* DOWNLOAD */
document.getElementById("downloadBtn").onclick = () => {
    const blob = new Blob([getReportHTML()], {type:"text/html"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "CSV_Report.html";
    a.click();
    URL.revokeObjectURL(url);
};
</script>

</body>
</html>
